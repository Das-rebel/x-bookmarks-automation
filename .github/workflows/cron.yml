name: Daily Bookmark Scraping

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM UTC
  workflow_dispatch:      # Manual trigger option

jobs:
  scrape:
    runs-on: ubuntu-latest
    name: Scrape X.com Bookmarks
    
    steps:
      - name: Scrape Bookmarks
        run: |
          echo "ğŸš€ Starting daily bookmark scraping..."
          echo "â° Time: $(date -u)"
          
          # Call your ngrok endpoint
          RESPONSE=$(curl -s -X POST "https://60511f1f851c.ngrok-free.app/api/scrape" \
            -H "Content-Type: application/json" \
            -d '{"action":"scrape_bookmarks","source":"github_actions"}' \
            -w "\nHTTP_STATUS:%{http_code}")
          
          # Extract response and status
          HTTP_STATUS=$(echo "$RESPONSE" | tail -n1 | sed 's/.*HTTP_STATUS://')
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "ğŸ“Š Response: $RESPONSE_BODY"
          echo "ğŸ”¢ HTTP Status: $HTTP_STATUS"
          
          if [ "$HTTP_STATUS" = "200" ]; then
            echo "âœ… Scraping initiated successfully!"
            exit 0
          else
            echo "âŒ Scraping failed with status $HTTP_STATUS"
            exit 1
          fi
      
      - name: Notify Success
        if: success()
        run: |
          echo "ğŸ‰ Daily bookmark scraping completed successfully!"
          echo "ğŸ“… Date: $(date -u)"
          echo "ğŸŒ Endpoint: https://60511f1f851c.ngrok-free.app/api/scrape"
      
      - name: Notify Failure
        if: failure()
        run: |
          echo "ğŸš¨ Daily bookmark scraping failed!"
          echo "ğŸ“… Date: $(date -u)"
          echo "ğŸ” Check the logs above for details"
